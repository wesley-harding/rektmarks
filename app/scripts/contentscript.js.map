{"version":3,"sources":["app/scripts.babel/contentscript.js"],"names":[],"mappings":"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","file":"app/scripts.babel/contentscript.js","sourcesContent":["'use strict';\n\n/*\n  Functionality\n */\nvar $ = jQuery;\n$(document ).ready(function(){\n    var rektmarks_marks = [];\n\n    var contextMenuDetails = {\n        \"title\": \"Rektmark This\",\n        \"contexts\": [\n            \"page\", \"link\", \"image\", /*\"video\",*/ \"browser_action\", \"page_action\" ],\n        \"onclick\": handleContextMenuClick\n    };\n\n    /* Dom selectors */\n    var $cards, $sidebar, $dropzone, $close, $newcardarea, $submit_new;\n\n    /* Other variables */\n    var syncAvailable;\n\n    function initialize() {\n        var doEventBinding = false;\n\n        //If chrome runtime is available\n        syncAvailable = true;//typeof chrome[ 'runtime' ] !== 'undefined';\n\n        //Inject the sidebar\n        if(typeof $sidebar === 'undefined') {\n            $( sideBarMarkup() ).appendTo( 'body' );\n            $sidebar = $( '#rektmarks_sidebar' );\n            $dropzone = $('#rektmarks_dropzone');\n            doEventBinding = true;\n        }\n\n\n        if(typeof $close === 'undefined') {\n            $close = $('#rektmarks_close');\n        }\n\n        if(typeof $newcardarea === 'undefined'){\n            $newcardarea = $('#rektmarks_new_card_container')\n        }\n\n        if(typeof chrome['contextMenus'] !== 'undefined'){\n            chrome.contextMenus.create(contextMenuDetails, function(){\n                console.log('Added context menu');\n            });\n        }\n\n        //Inject the cards\n        if(typeof $cards === 'undefined') {\n            $cards = $('#rektmarks_cards');\n\n        }\n\n        if( doEventBinding ){\n            bindEvents();\n        }\n\n        syncCards( function () {\n            console.log('Cards sync\\'d injecting cards')\n            clearCards( $cards );\n            injectCards( $cards );\n        } );\n    }\n\n\n    function validateCard(cardDetails) {\n        //TODO: Write validation\n    }\n\n    /**\n     * Creates a card\n     * @param cardDetails\n     * @param disableEvent disables sending an event to background script\n     * @returns {{id: *, date: Date, url: *, title: *, description: (string|description|*|d|e|Document.description), type: *}}\n     */\n    function addCard(cardDetails, disableEvent){\n        /* Required */\n        var url = cardDetails.url;\n        /* Optional */\n        var title = cardDetails.title;\n        var description = cardDetails.description;\n        var type = cardDetails.type;\n        /* Generated */\n        var id = psuedoUUID();\n        var date = (new Date()).toString();\n\n        var card = {\n            id,\n            date,\n            url,\n            title,\n            description,\n            type\n        };\n\n        // Unshift so were added to the beginning\n        rektmarks_marks.unshift(card);\n\n        //Tell the Backend\n        if(syncAvailable) {\n            console.log('Sending Message');\n            chrome.runtime.sendMessage( {\n                action: 'addCard',\n                data: {\n                    card: card\n                }\n            }, function () {\n                console.info( 'Rektmarks: Successfully Deleted mark' );\n            } );\n        }\n\n        return card;\n    }\n\n    /**\n     * Deletes a card\n     * @param id  ID of the card to delete\n     * @param disableEvent disables sending an event to background script\n     */\n    function deleteCard(id, disableEvent){\n        var needleIndex;\n        var deletedCard;\n\n        rektmarks_marks.forEach(function(card,index) {\n            var cardId = card.id;\n\n            if(id == cardId) {\n                needleIndex = index;\n            }\n        });\n\n        if(needleIndex !== undefined){\n            deletedCard = rektmarks_marks.splice(needleIndex, 1);\n\n            if(deletedCard.length > 0) {\n                deletedCard = deletedCard[0]; //We only care about the first element, so we'll extract it from the array\n            } else {\n                deletedCard = undefined;\n            }\n\n        }\n\n        if(!disableEvent && syncAvailable) {\n            //Tell the Backend\n            chrome.runtime.sendMessage({\n                action: 'deleteCard',\n                data: {\n                    cardId: id\n                }\n            }, function(){\n                console.info('Rektmarks: Successfully Deleted mark');\n            });\n        }\n\n        return deletedCard;\n    }\n\n    function syncCards(callback){\n        console.log('Sync cards');\n\n        if(!syncAvailable){\n            return callback(rektmarks_marks);\n        }\n        chrome.runtime.sendMessage({\n            action: 'syncCards'\n        }, function(result){\n            console.log('Sync Complete');\n            if(result.data.cards.length > 0) {\n                rektmarks_marks = result.data.cards;\n            }\n            callback(rektmarks_marks);\n        });\n    }\n\n    function insertNewCard(cardDetails) {\n        var markup = cardMarkup(cardDetails);\n        $cards.prepend(markup);\n    }\n\n    function injectCards($target) {\n        rektmarks_marks.forEach(function(card, index){\n            var markup = cardMarkup(card);\n            $(markup).appendTo($target);\n        });\n    }\n\n    function clearCards($target) {\n        $target.html('');\n    }\n\n    function bindEvents() {\n        $dropzone.on('drop', function(event){\n            event.stopPropagation();\n            event.preventDefault();\n        });\n        $dropzone.on('dragend drop', function(event){\n            hideDropArea();\n            event.stopPropagation();\n        });\n        $dropzone.on('dragenter', function(){\n            $dropzone.addClass('rektmarks_over');\n        });\n        $dropzone.on('dragleave dragend drop', function(){\n            $dropzone.removeClass( 'rektmarks_over' );\n        });\n        $dropzone.on('drop', function(event){\n            var src = event.originalEvent.dataTransfer.getData( 'application/json' );\n            src = JSON.parse(src);\n            showNewCard(src);\n        });\n        $close.on('click', function(){\n            hideSidebar();\n        });\n        $( 'body' ).on( 'dragstart', function ( event ) {\n            var src = extractSource(event.target);\n\n            showSidebar();\n            showDropArea();\n\n            event.originalEvent.dataTransfer.effectAllowed = 'all';\n            event.originalEvent.dataTransfer.setData( 'application/json',  JSON.stringify(src));\n        } );\n\n        $('#rektmarks_sidebar').on('click', '.rektmarks_card_delete', function(event){\n            event.preventDefault();\n            var cardId = $(this).data('rektmarks-id');\n            var deletedCard = deleteCard(cardId);\n\n            if(deletedCard) {\n                clearCards( $cards );\n                injectCards( $cards );\n            }\n        });\n\n        if(syncAvailable){\n            //Listen for messages passed from the backend\n            chrome.runtime.onMessage.addListener(\n                function ( request, sender, sendResponse ) {\n                    console.log('Content script received message');\n                    console.info(request);\n                    if(request.action == 'deleteCard') {\n                        var cardId = request.data.cardId;\n                        var cards = request.data.cards;\n\n                        if(cardId) {\n                            deleteCard(cardId, true);\n                            clearCards( $cards );\n                            injectCards( $cards );\n                        }\n\n                    } else if (request.action == 'addCard'){\n                        var card = request.data.card;\n                        var cards = request.data.cards;\n                        if(card){\n                            addCard(card, true);\n                            clearCards( $cards );\n                            injectCards( $cards );\n                        }\n                    } else if(request.action == 'syncCards'){\n                        var cards = request.data.cards;\n                        rektmarks_marks = cards;\n                        clearCards( $cards );\n                        injectCards( $cards );\n                    } else if(request.action == 'showSideBar'){\n                        showSidebar();\n                    }\n                }\n            );\n        }\n    }\n\n    function extractSource(target) {\n        console.log(target.tagName);\n        console.log(target);\n        if(target.tagName.toLowerCase() == 'img') {\n            return {\n                type: 'img',\n                src: target.src\n            };\n        }\n\n        if(target.tagName.toLowerCase() == 'a') {\n            return {\n                type: 'a',\n                src: target.href || 'http://google.com'\n            }\n        }\n\n        return false;\n    }\n\n    function showSidebar() {\n        $sidebar.show();\n    }\n\n    function hideSidebar() {\n        $sidebar.hide();\n        hideNewCard();\n    }\n\n    function showDropArea(){\n        $dropzone.show();\n    }\n    function hideDropArea(){\n        $dropzone.hide();\n    }\n    function showNewCard(details){\n\n        var markup = newCardMarkup(details);\n        $newcardarea.html(markup);\n\n        $submit_new = $( '#rektmarks_save' );\n        $submit_new.on('click', submitNewCard);\n    }\n    function hideNewCard(){\n        $newcardarea.html('');\n    }\n    function submitNewCard() {\n        var title = $('#rektmarks_new_title').val();\n        var url = $('#rektmarks_new_src').attr('src');\n        var description = $('#rektmarks_new_description').val();\n        var type = $('#rektmarks_new_type').val();\n\n        console.log('Saving new card');\n\n        var newCard = addCard( {\n            url,\n            title,\n            description,\n            type\n        } );\n        hideNewCard();\n        insertNewCard( newCard );\n    }\n\n    function handleContextMenuClick(){\n        console.log('Menu clicked');\n    }\n\n    function psuedoUUID() {\n        var d = new Date().getTime();\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace( /[xy]/g, function ( c ) {\n            var r = (d + Math.random() * 16) % 16 | 0;\n            d = Math.floor( d / 16 );\n            return (c == 'x' ? r : (r & 0x3 | 0x8)).toString( 16 );\n        } );\n        return uuid;\n    }\n\n    function sideBarMarkup() {\n        return `\n            <div id=\"rektmarks_sidebar\" style=\"display: none;\">\n                <div id=\"rektmarks_dropzone\"  ondragover=\"event.preventDefault()\" style=\"display: none\">Get Rekt</div>\n                <div id=\"rektmarks_close\">X</div>\n                <div id=\"rektmarks_header\">\n                    <h2 id=\"rektmarks_main_title\">Rektmarks</h2>\n                    <span id=\"rektmarks_rekt_source\"><a href=\"http://github.com/wesley-harding/rektmarks\" target=\"_blank\">Rek my source!</a></span>\n                    <input id=\"rektmarks_search\" type=\"search\" placeholder=\"Search (coming soon)\">\n                    <div id=\"rektmarks_new_card_container\">\n                    </div>\n                    <hr>\n                    <h2>Your Rektmarks</h2>\n                </div>\n                <div id=\"rektmarks_cards\">\n                    <!--<h5>Whoops! You have no bookmarks</h5>-->\n                </div>\n            </div>\n        `;\n    }\n\n    function cardMarkup(cardDetails) {\n        return `\n            <div class=\"rektmarks_card\" data-rektmarks-id=\"${cardDetails.id}\">\n                <h3 class=\"rektmarks_card_title\">${cardDetails.title || ''}</h3>\n                <div class=\"rektmarks_card_preview\">\n                    <!-- TODO: Let's actually check if this is an image -->\n                    <a href=\"${cardDetails.url}\" target=\"_blank\">\n                        <img class=\"rektmarks_card_url\" src=\"${cardDetails.url}\" alt=\"Preview\">\n                    </a>\n                </div>\n                <a class=\"rektmarks_card_src\" href=\"${cardDetails.url}\" target=\"_blank\">${cardDetails.url.substring(0, 40)}</a>\n                <p class=\"rektmarks_card_description\">${cardDetails.description || ''}</p>\n                <span class=\"rektmarks_card_date\">${cardDetails.date}</span>\n                <br>\n                <a href=\"#\" class=\"rektmarks_card_delete\" data-rektmarks-id=\"${cardDetails.id}\">Delete</a>\n            </div>\n        `;\n    }\n\n    function newCardMarkup(cardDetails){\n        return `\n            <h3 id=\"rektmarks_new_copy\">Rek Something</h3>\n            <div id=\"rektmarks_new_card\">\n                <input id=\"rektmarks_new_title\" type=\"text\" placeholder=\"Name\">\n                <img id=\"rektmarks_new_src\" src=\"${cardDetails.src}\" alt=\"Preview\">\n                <textarea id=\"rektmarks_new_description\" placeholder=\"Description\"></textarea>\n                <input id=\"rektmarks_new_type\" type=\"hidden\" value=\"${cardDetails.type}\">\n                <button id=\"rektmarks_save\">Rekt It</button>\n            </div>\n        `;\n    }\n\n    /*\n     Run\n     */\n\n\n    console.info( 'Loading Rektmarks' );\n    initialize();\n});\n"]}